REPORT: REFERER STATEMENT - PATIENT (ALL/SELECTED)
==================================================
GROUP = REFERID (REFER TOTAL, GRAND TOTAL)

SELECT DISTINCT REFERNM, A.PATIENTID, PATIENTNM,  MOBNO, ISNULL(NETAMT,0) NETAMT, ISNULL(RCVAMT,0) PAIDAMT,  ISNULL(DUEAMT,0) BALAMT
FROM HMS_OPDMST A, HMS_OPD B, HMS_REFER C 
WHERE A.COMPID = B.COMPID
AND   A.COMPID = C.COMPID
AND   A.TRANSDT   = B.TRANSDT
AND   A.PATIENTID = B.PATIENTID
AND   A.REFERID   = C.REFERID
AND   A.COMPID    = '101'
AND   A.TRANSDT BETWEEN '2015-01-01' AND '2015-10-01'
ORDER BY A.PATIENTID


REPORT: REFERER STATEMENT - SUMMARY (ALL/SELECTED)
==========================================
GROUP = REFERID (REFER TOTAL, GRAND TOTAL)

SELECT A.REFERID, TRANSDT, PATIENTID, PATIENTNM, ISNULL(AMOUNT,0) AMOUNT, ISNULL(REFAMT,0) REFAMT, ISNULL(DISCREF,0) DISCREF, ISNULL(DISCHOS,0) DISCHOS, ISNULL(DISCNETM,0) DISCNETM,
ISNULL(BALAMTM,0) BALAMTM, ISNULL(DISCNETR,0) DISCNETR, ISNULL(BALAMTR,0) BALAMTR,
(ISNULL(DISCNETM,0)+ISNULL(DISCNETR,0)) DISCNET, (ISNULL(REFAMT,0)-(ISNULL(DISCNETM,0)+ISNULL(DISCNETR,0))) REFNET
FROM(
SELECT A.TRANSDT, A.REFERID, A.PATIENTID, PATIENTNM, SUM(ISNULL(AMOUNT,0)) AMOUNT, SUM((ISNULL(AMOUNT,0)*ISNULL(PCNTD,0))/100) REFAMT, ISNULL(DISCREF,0) DISCREF, ISNULL(DISCHOS,0) DISCHOS,
ISNULL(DISCNET,0) DISCNETM, ISNULL(DUEAMT,0) BALAMTM, 0 DISCNETR, 0 BALAMTR
FROM HMS_OPDMST A, HMS_OPD B
WHERE A.COMPID = B.COMPID
AND   A.TRANSDT = B.TRANSDT
AND   A.PATIENTID = B.PATIENTID
AND   ISNULL(A.DUEAMT,0) = 0
AND   A.COMPID    = '101'
AND   A.TRANSDT BETWEEN '2015-01-01' AND '2015-09-16'
GROUP BY A.TRANSDT, A.REFERID, A.PATIENTID, PATIENTNM, ISNULL(DISCNET,0), ISNULL(DUEAMT,0), ISNULL(DISCREF,0), ISNULL(DISCHOS,0)
UNION ALL
SELECT C.TRANSDT, A.REFERID, A.PATIENTID, PATIENTNM, SUM(ISNULL(AMOUNT,0)) AMOUNT, SUM((ISNULL(AMOUNT,0)*ISNULL(PCNTD,0))/100) REFAMT, ISNULL(A.DISCREF,0) DISCREF, ISNULL(A.DISCHOS,0) DISCHOS,
ISNULL(A.DISCNET,0) DISCNETM, ISNULL(A.DUEAMT,0) BALAMTM, ISNULL(C.DISCHOS,0) DISCNETR, ISNULL(C.DUEAMT,0) BALAMTR
FROM HMS_OPDMST A, HMS_OPD B, HMS_OPDRCV C
WHERE A.COMPID = B.COMPID
AND   A.COMPID = C.COMPID
AND   A.TRANSDT = B.TRANSDT
AND   A.PATIENTID = B.PATIENTID
AND   A.PATIENTID = C.PATIENTID
AND   ISNULL(A.DUEAMT,0) <> 0
AND   ISNULL(C.DUEAMT,0) = 0
AND   A.COMPID    = '101'
AND   C.TRANSDT BETWEEN '2015-01-01' AND '2015-09-16'
GROUP BY C.TRANSDT, A.REFERID, A.PATIENTID, PATIENTNM, ISNULL(A.DISCREF,0), ISNULL(A.DISCHOS,0), ISNULL(A.DISCNET,0), ISNULL(A.DUEAMT,0), ISNULL(C.DISCHOS,0), ISNULL(C.DUEAMT,0)
) A
ORDER BY REFERID, PATIENTID

REPORT: REFERER STATEMENT - DETAILS (ALL/SELECTED)
==========================================
GROUP-1 = REFERID (REFER TOTAL, GRAND TOTAL)
GROUP-2 = PATIENTID (ID WISE TOTAL)

SELECT REFERID, TRANSDT, PATIENTID, PATIENTNM PATIENTNM, A.TESTID, TESTNM, A.PCNTD, ISNULL(AMOUNT,0) AMOUNT, 
ISNULL(REFAMT,0) REFAMT, ISNULL(DISCREF,0) DISCREF, ISNULL(DISCHOS,0) DISCHOS, 
ISNULL(DISCNETM,0) DISCNETM,
ISNULL(DUEAMTM,0) DUEAMTM, ISNULL(DISCNETR,0) DISCNETR, ISNULL(DUEAMTR,0) DUEAMTR,
(ISNULL(DISCNETM,0)+ISNULL(DISCNETR,0)) DISCNET
FROM(
SELECT A.COMPID, A.TRANSDT, A.REFERID, A.PATIENTID, PATIENTNM, TESTID, PCNTD, 
SUM(ISNULL(AMOUNT,0)) AMOUNT, SUM((ISNULL(AMOUNT,0)*ISNULL(PCNTD,0))/100) REFAMT, 
ISNULL(DISCREF,0) DISCREF, ISNULL(DISCHOS,0) DISCHOS, ISNULL(DISCNET,0) DISCNETM, 
ISNULL(DUEAMT,0) DUEAMTM, 0 DISCNETR, 0 DUEAMTR
FROM(
SELECT COMPID, TRANSDT, REFERID, PATIENTID, TESTID, PCNTD, SUM(ISNULL(AMOUNT,0)) AMOUNT, 
SUM((ISNULL(AMOUNT,0)*ISNULL(PCNTD,0))/100) REFAMT
FROM HMS_OPD
GROUP BY COMPID, TRANSDT, REFERID, PATIENTID, TESTID, PCNTD
) A, HMS_OPDMST B
WHERE A.COMPID  = B.COMPID
AND   A.TRANSDT = B.TRANSDT
AND   A.PATIENTID = B.PATIENTID
AND   ISNULL(DUEAMT,0) = 0
AND   A.COMPID    = '101'
AND   A.TRANSDT BETWEEN '2015-01-01' AND '2015-10-01'
GROUP BY A.COMPID, A.TRANSDT, A.REFERID, A.PATIENTID, PATIENTNM, TESTID, PCNTD, 
ISNULL(DISCREF,0), ISNULL(DISCHOS,0), ISNULL(DISCNET,0), ISNULL(DUEAMT,0)
UNION ALL
SELECT C.TRANSDT, A.COMPID, A.REFERID, A.PATIENTID, PATIENTNM, TESTID, PCNTD, 
SUM(ISNULL(AMOUNT,0)) AMOUNT, SUM((ISNULL(AMOUNT,0)*ISNULL(PCNTD,0))/100) REFAMT, 
ISNULL(B.DISCREF,0) DISCREF, ISNULL(B.DISCHOS,0) DISCHOS, ISNULL(B.DISCNET,0) DISCNETM, 
ISNULL(B.DUEAMT,0) DUEAMTM, ISNULL(C.DISCHOS,0) DISCNETR, ISNULL(C.DUEAMT,0) DUEAMTR
FROM(
SELECT COMPID, TRANSDT, REFERID, PATIENTID, TESTID, PCNTD, SUM(ISNULL(AMOUNT,0)) AMOUNT, 
SUM((ISNULL(AMOUNT,0)*ISNULL(PCNTD,0))/100) REFAMT
FROM HMS_OPD
GROUP BY COMPID, TRANSDT, REFERID, PATIENTID, TESTID, PCNTD
) A, HMS_OPDMST B, HMS_OPDRCV C
WHERE A.COMPID = B.COMPID
AND   A.COMPID = C.COMPID
AND   A.TRANSDT = B.TRANSDT
AND   A.PATIENTID = B.PATIENTID
AND   B.PATIENTID = C.PATIENTID
AND   ISNULL(B.DUEAMT,0) <> 0
AND   ISNULL(C.DUEAMT,0) = 0
AND   A.COMPID    = '101'
AND   C.TRANSDT BETWEEN '2015-01-01' AND '2015-10-01'
GROUP BY C.TRANSDT, A.COMPID, A.REFERID, A.PATIENTID, PATIENTNM, TESTID, PCNTD, 
ISNULL(B.DISCREF,0), ISNULL(B.DISCHOS,0), ISNULL(B.DISCNET,0), ISNULL(B.DUEAMT,0), 
ISNULL(C.DISCHOS,0), ISNULL(C.DUEAMT,0)
) A INNER JOIN HMS_TEST ON A.COMPID = HMS_TEST.COMPID AND A.TESTID = HMS_TEST.TESTID
ORDER BY REFERID, PATIENTID