REPORT NAME: DAILY MISMATCH REPORT
PARAMETER  : TRANSDT
----------------------------------
SELECT A.TRANSDT, A.PATIENTID, PATIENTNM, USERNM, B.INSTIME, SUM(ISNULL(TESTAMT,0)) TESTAMT, SUM(ISNULL(A.TOTAMT,0)) TOTAMT FROM(
SELECT COMPID, TRANSDT, PATIENTID, SUM(ISNULL(AMOUNT,0)) TESTAMT, 0 TOTAMT FROM HMS_OPD
WHERE  COMPID = '101' AND TRANSDT = '2016-10-05' GROUP BY COMPID, TRANSDT, PATIENTID
UNION
SELECT COMPID, TRANSDT, PATIENTID, 0 TESTAMT, ISNULL(TOTAMT,0) TOTAMT FROM HMS_OPDMST
WHERE  COMPID = '101' AND TRANSDT = '2016-10-05' 
) A LEFT OUTER JOIN HMS_OPDMST B ON A.COMPID = B.COMPID AND A.TRANSDT = B.TRANSDT AND A.PATIENTID = B.PATIENTID
LEFT OUTER JOIN ASLUSERCOES C ON B.COMPID = C.COMPID AND B.INSUSERID = C.USERID
GROUP BY A.TRANSDT, A.PATIENTID, PATIENTNM, B.INSTIME, USERNM HAVING SUM(ISNULL(TESTAMT,0)) <> SUM(ISNULL(A.TOTAMT,0))
ORDER BY A.TRANSDT, A.PATIENTID